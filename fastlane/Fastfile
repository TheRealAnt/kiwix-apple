# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

platform :ios do
  desc "Build the iOS app for development "
  lane :devbuild do
    ci_settings
    match_ios_dev_certificates
    build_app(scheme: "Kiwix",
              destination: "generic/platform=iOS",
              sdk: 'iphoneos',
              export_options: {
                method: "development",
                signingStyle: 'manual',
                provisioningProfiles: {
                "self.Kiwix": "match Development self.Kiwix",
                }
              })
            end
end

platform :mac do
  desc "Build the macOS app for development"
  lane :devbuild do
    build_app(scheme: "Kiwix",
              destination: "generic/platform=macOS",
              export_options: {
                method: "development",
                signingStyle: 'manual'
              })
  end
end

private_lane :ci_settings do
  if is_ci
    setup_ci
    xcode_select "/Applications/Xcode_15.0.1.app"
  end
end

private_lane :match_ios_dev_certificates do
  if is_ci
    match(type: "development", readonly: true, git_url: "./certificates")
  else
    match(type: "development", readonly: true)
  end
end

private_lane :match_ios_appstore_certificates do
  if is_ci
    match(type: "appstore", readonly: true, git_url: "./certificates")
  else
    match(type: "appstore", readonly: true)
  end
end