# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

platform :ios do
  desc "Build the iOS app for development "
  lane :devbuild do
    ci_settings
    build_app(scheme: "Kiwix",
              destination: "generic/platform=iOS",
              sdk: 'iphoneos',
              export_options: {
                method: "development"
              })
  end
end

platform :mac do
  desc "Build the macOS app for development"
  lane :devbuild do
    build_app(scheme: "Kiwix",
              destination: "generic/platform=macOS")
  end
end

private_lane :ci_settings do
  if is_ci
    xcode_select("/Applications/Xcode_15.0.1.app")
    unlock_keychain(
      path: ENV['KEYCHAIN'],
      password: ENV['KEYCHAIN_PASSWORD'],
      set_default: true)
  end
end

private_lane :match_ios_dev_certificates do
  if is_ci
    match(type: "development", readonly: true, git_url: "./certificates")
  else
    match(type: "development", readonly: true)
  end
end

private_lane :match_ios_appstore_certificates do
  if is_ci
    match(type: "appstore", readonly: true, git_url: "./certificates")
  else
    match(type: "appstore", readonly: true)
  end
end